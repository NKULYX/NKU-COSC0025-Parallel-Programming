# Intel Core CPU的发展历史

| 代数 |   型号    | 核心数 | 线程数 | 最大主频 | 三级缓存 | 二级缓存 |
| :--: | :-------: | :----: | :----: | :------: | :------: | :------: |
|  7   | i7-7700K  |   4    |   8    |  4.5GHz  |   8MB    |   1MB    |
|  8   | i7-8086K  |   6    |   12   |  5.0GHz  |   12MB   |  1.5MB   |
|  9   | i9-9900K  |   8    |   16   |  5.0GHz  |   16MB   |   2MB    |
|  10  | i9-10900K |   10   |   20   |  5.2GHz  |   20MB   |  2.5MB   |
|  11  | i9-11900K |   8    |   16   |  5.3GHz  |   16MB   |   2MB    |
|  12  | i9-12900H |   16   |   20   |  5.2GHz  |   30MB   |   14MB   |

# Intel 12th Core CPU参数

以Intel 12th Core i9 为例

|      指标       |     数据      |
| :-------------: | :-----------: |
|    最大主频     |    5.2GHz     |
| P-Core 最大频率 |    5.1GHz     |
| E-Core 最大频率 |    3.9GHZ     |
|  处理器内核数   |      16       |
|     P-Core      |       8       |
|     E-Core      |       8       |
|  处理器线程数   |      24       |
|     L3 Cash     |     30MB      |
|     L2 Cash     |     14MB      |
|  最大内存速度   | DDR5 4800MT/s |

# Intel 7 制程工艺

Intel移动端的处理器早在2019年就开始使用了10nm的制程工艺，而桌面端直到上一代11代处理器仍在打磨14nm制程工艺，如今在Intel 12th CPU上终于采用了最新的Intel7制程工艺。Intel 7 实际上是原来叫做 10nm Enhaced SuperFin，属于Intel第三代10nm技术。相较于14nm技术，10nm制程工艺能够在同等面积的芯片上集成更多的晶体管，因此性能能够有很大的提升，除此之外，10nm的能耗也要由于14nm的制程工艺。虽然目前最细的制程工艺是台积电的7nm，但是Intel7的10nm制程工艺的晶体管密度还要比台积电7nm的晶体管密度稍高一些。

|                  | Intel 10nm | 台积电 7nm |
| :--------------: | :--------: | :--------: |
| 万晶体管/ $mm^2$ |   10076    |    9650    |

# Intel 12th Core 架构设计

Intel 12th Core 采用了大小核混合架构的设计，即性能核心（Performance Core）和能效核心（Efficient Core）。

![Intel 12代酷睿细节公开：功耗低至9W、大小核必须配Win11](E:\学习资料\大二\并行程序设计\Experiment\调研\s_a991b8031e974f40838bdc54f32a43b9.jpg)

P-Core支持超线程，频率在3.2-5.1GHz，E-Core不支持超线程，频率在2.4-3.9GHz。在缓存方面，每个P-Core拥有256KB的指令缓存和48KB的数据缓存，每一个P-Core独享1.25MB的L2 Cash；每一个E-Core拥有64KB的指令缓存和32KB的数据缓存，八个E-Core共享4MB的L2 Cash。P-Core和E-Core共享30MB的三级缓存。

![image-20220227170838930](E:\学习资料\大二\并行程序设计\Experiment\调研\image-20220227170838930.png)

![image-20220227170901851](E:\学习资料\大二\并行程序设计\Experiment\调研\image-20220227170901851.png)

大小核设计的目的：大小核设计在ARM架构下已经很早就手机上进行推广了，但是x86的PC端如今是第一次采用大小核的架构设计。除了考虑到大小核设计能够降低功耗之外，其最大的目的还是兼顾了单核性能的提升和多核性能的均衡。P-Core 最大限度地提高单线程性能和相应速度，而 E-Core 则为现代多任务处理提供可扩展的多线程性能和高效的后台任务卸载。

现代的CPU微架构主要可以分为前端和后端两部分，前端主要负责取指和解码两部分操作，后端主要实现执行和写回这两个操作。前端需要尽可能多从内存中获取指令，并将其解码成后端能够直接执行的微操作，此外，前端还需要能够进行准确快速的分支判断。因此前端在设计架构时的目标，一个是要有足够的深度，能够缓存足够多的指令，减少数据从内存传输的CPU的等待时间，也能够降低访存带来的功。另一个是提高分支判断的准确性，能够正确预测后续的指令，避免因为预测失误而冲刷流水线导致巨大的性能损失。后端优化地主要目的则是要尽可能地提高宽度，让更多解码后的微指令可以并行乱序地去执行。需要提供更多地发射端口、乱序执行窗口以及更多的算术逻辑单元ALU等等。

就E-Core而言，在前端方面，包含64KB的指令缓存，可以再不消耗子系统功率的情况下保存可用的指令；使用了Intel的第一个按需指令长的解码器，可以预测解码信息，加速现代工作的负载；进一步优化的分支预测单元，借助更深的分支历史和更大的指令尺寸，拥有5000个条目的分支目标缓存区，极大提高了分支预测的准确性。E-Core还包含了两个3宽度的乱序解码器，继承了Tremont的低功耗内核，将解码宽度由原来的4提升到6，能够单周期完成高达6个指令的解码，还能在这两个解码器之间做负载均衡和乱序执行，从而进一步提升解码操作的并行性。

![image-20220227175847534](E:\学习资料\大二\并行程序设计\Experiment\调研\image-20220227175847534.png)

在后端方面，具备5组宽度分配、8组宽度引退、256个乱序窗口入口、17个执行端口，以及4个整数ALU、2个载入AGU、2个存储AGU、2个跳转端口、2个整数存储数据、2个浮点/矢量存储、2个浮点/矢量堆栈、以及第3个矢量ALU。

![image-20220227210558360](E:\学习资料\大二\并行程序设计\Experiment\调研\image-20220227210558360.png)

# 性能优化和调度

为了能够保证分支预测的准确性，减少因为预测错误导致流水线的冲刷，在E-Core的分支预测单元中，采用了机器学习的方法，不仅能够提升分支预测的准确性，还能够根据代码量动态调整缓存的大小。后端在分配微指令的时候，也可以预先执行一些简单的指令，从而快速释放后端指令流水线的资源，提升系统的吞吐量。存储系统也可以学习数据的读写模型，从而判断数据之间的依赖程度，并以此作为进出缓存的重要依据。

Intel提出的线程调度器，存在于操作系统与硬件之间，可以监测线程和内核的运行情况，并将这些信息传送给操作系统，为OS中的线程调度提供支持。对于性能要求比较高的进程，就会被有限放在P-Core上进行，而对于一些后台任务则会被放在E-Core上运行，如果有优先级更高的进程出现的时候，线程调度器就可以帮助操作系统来决定将P-Core上的哪些线程转移到E-Core上来运行。这些调度器都是动态来完成的，而不是依赖具体的软件或者静态的调度方法实现的。Intel Thread Director 与操作系统（OS）无缝协作智能优化性能，在正确时间将正确的任务放在正确的内核上。



英特尔超线程技术（英特尔 HT 技术）能够更高效地利用处理器资源，支持每个内核运行多条线程。作为一项特性，它还提高了处理器吞吐量以及线程化软件的整体性能。

* 在运行多个要求严苛的应用程序的同时保证系统的响应能力
* 在保证系统安全，高效，可靠的同时，把对工作效率的影响降到最低
* 给未来业务增长和全新解决方案能力提供充足的扩展空间

# 性能对比

我们选取了Intel Core i9-12900HK，Apple M1 MAX，Intel Core i9-11980HK和AMD Ryzen 9 5980HX进行对比，通过数据可以得出，无论是在单核性能还是多核性能方面，Intel Core i9-12900HK均有显著的优势，Intel相比自身上一代处理器，在单核和多核方面的性能提升分别为6%和26%，而对比AMD同期的Ryzen9，在单核和多核方面性能更是高出了22%和57%。

|          CPU          | 单核性能 | 多核性能 |
| :-------------------: | :------: | :------: |
| Intel Core i9-12900HK |   1851   |  13256   |
|     Apple M1 MAX      |   1785   |  12753   |
| Intel Core i9-11980HK |   1745   |  10486   |
|  AMD Ryzen 9 5980HX   |   1523   |   8469   |

# 总结

本次Intel最新推出的12th Core CPU，首次采用了Intel 7 的制程工艺，并且率先在桌面端推出了大小核结合的CPU架构。通过性能核心和能效核心的配合，在控制功耗的前提下，既提升了单核的处理性能，又发挥了多核的并行性能。不仅在硬件层面做出了极大的优化，而且采用了线程调度器，能够合理地在硬件和操作系统之间调度线程。

Intel将现有的计算模式分为：标量积算，向量计算，矩阵计算和空间计算四大类，分别对应基于CPU，GPU，ASIC和FPGA的计算模式，通过这四种类型计算的组合，就可以提供超过摩尔定律发展的非线性的性能提升。当前的芯片设计架构思路主要分为两个方面，一方面是针对特定的专业领域设计专属的芯片架构，另一方面是对不同计算模式之间取长补短达到异构计算的目的，通过这两方面来取得系统性能和功耗的平衡和优化。